<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anki Heatmap</title>
    <style>
.heatmap-container {
    display: grid;
    grid-template-rows: repeat(7, 20px); /* 7 days as rows */
    grid-auto-flow: column; /* Horizontal flow */
    gap: 2px;
    padding: 0 5px;
    border: 1px solid #ccc;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    width: 100%
    overflow-x: scroll;
    overflow-y: hidden;
}
body {
    margin: 0; 
    padding: 0;
}
.day-cell {
    width: 20px;
    height: 20px;
    background-color: #ebedf0;
    border-radius: 2px;
}
.level-0 { background-color: #ebedf0; }
.level-1 { background-color: #9be9a8; }
.level-2 { background-color: #40c463; }
.level-3 { background-color: #30a14e; }
.level-4 { background-color: #216e39; }
    </style>
</head>
<body>

<div class="heatmap-container" id="heatmap"></div>

<script>
    const HEATMAP = document.getElementById('heatmap');
    const NUM_DAYS = 366; // Display a year's worth of data

    async function loadHeatmapData() {
        try {
            const response = await fetch('heatmap.json');
            const { start_epoch, counts } = await response.json();
            renderHeatmap(start_epoch, counts);
        } catch (error) {
            console.error('Error loading heatmap data:', error);
            const fakeStartEpoch = Math.floor(Date.now() / 1000) - NUM_DAYS * 86400;
            renderHeatmap(fakeStartEpoch, generateFakeData(NUM_DAYS));
        }
    }

    function renderHeatmap(startEpoch, data) {
        HEATMAP.innerHTML = '';

        const DAYS_IN_WEEK = 7;
        const startDate = new Date(startEpoch * 1000);
        const firstDayOfWeek = startDate.getUTCDay();

        // 1. Padding for alignment
        for (let i = 0; i < firstDayOfWeek; i++) {
            const cell = document.createElement('div');
            cell.className = 'day-cell level-0';
            cell.style.visibility = 'hidden';
            HEATMAP.appendChild(cell);
        }

        const displayData = Array(NUM_DAYS).fill(0).concat(data).slice(-NUM_DAYS);
        const monthLabels = [];
        let currentMonth = -1;

        for (let i = 0; i < displayData.length; i++) {
            const count = displayData[i];
            // 86400 is seconds in a day
            const date = new Date((startEpoch + i * 86400) * 1000);
            const cell = document.createElement('div');

            // Add tooltip with actual date and count
            // Fixing syntax error in your original code: date.toISOString().split['T'](0)
            cell.title = `${date.toISOString().split('T')[0]}: ${count} reviews`;

            let level = 0;
            if (count > 0 && count <= 5) {
                level = 1;
            } else if (count > 5 && count <= 15) {
                level = 2;
            } else if (count > 15 && count <= 30) {
                level = 3;
            } else if (count > 30) {
                level = 4;
            }
            cell.className = `day-cell level-${level}`;
            HEATMAP.appendChild(cell);

            // Check for new month start - label the start of the month if it's a new week
            const dayIndexRelativeToStart = firstDayOfWeek + i;
            if (date.getUTCMonth() !== currentMonth && dayIndexRelativeToStart % DAYS_IN_WEEK === 0) {
                // Only push a label if we are at the start of a new month and the week starts on Sunday
                if (currentMonth !== -1 || i === 0) { // Push initial label even if it's not the start of the week
                    monthLabels.push({
                        month: date.toLocaleDateString('en-US', { month: 'short' }),
                        weekIndex: Math.floor(dayIndexRelativeToStart / DAYS_IN_WEEK)
                    });
                }
                currentMonth = date.getUTCMonth();
            }
        }
      HEATMAP.scrollLeft = HEATMAP.scrollWidth;
    }

    loadHeatmapData();
</script>

</body>
</html>
